#include "DHT.h"
#include <LiquidCrystal.h>

#define DHTTYPE DHT11
#define DHTPIN 12

DHT dht(DHTPIN, DHTTYPE);

const int rs = 11;
const int en = 10;
const int d4 = 22;
const int d5 = 23;
const int d6 = 24;
const int d7 = 25;

const int fan =13;
const int power = 2;
const int error = 5;
const int on = 6;
const int off = 4;

float temp;
float hum;
int powerStateCurrent = 0;
int powerStateLast;
int fanState = 0;

LiquidCrystal lcd(rs, en, d4, d5, d6, d7);

void setup() {
  // put your setup code here, to run once:
pinMode(fan, OUTPUT);
pinMode(power, INPUT);

Serial.begin(9600);
Serial.println("Current Room Temperature:");

lcd.begin(16, 2);

dht.begin();
}

void loop() {
  // put your main code here, to run repeatedly:
  lcd.setCursor(0,0);
  lcd.print("Temp C: ");
  lcd.print(temp,2);
  lcd.setCursor(0,1);
  lcd.print("Humidity: ");
  lcd.print(hum, 2);
  
  temp = dht.readTemperature();
  hum = dht.readHumidity();
  if(isnan(temp) || isnan(hum)){
   Serial.println("Error");
   digitalWrite(error, HIGH);
   digitalWrite(on, LOW);
   digitalWrite(off, LOW);
   digitalWrite(fan,LOW);
   return;
  }

  Serial.println(temp);
  
  powerStateLast = powerStateCurrent;
  powerStateCurrent = digitalRead(power);
if(powerStateCurrent == HIGH && powerStateLast == LOW){
  Serial.println(powerStateCurrent);
  fanState = !fanState;
  digitalWrite(fan, fanState);
  digitalWrite(on, fanState);
  digitalWrite(off, !fanState);
  digitalWrite(error, LOW);
  
}
}